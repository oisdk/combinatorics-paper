\chapter{Topos} \label{topos}
In this section we will prove that decidable Kuratowski finite types form a
\(\Pi\)-pretopos.
Along the way we will provide closure proofs for a number of the other
finiteness predicates.
As we saw in theorem~\ref{cardinal-kuratowski}, decidable Kuratowski finite
types are equivalent to cardinal finite types, so we will work with the latter
from now on.
Our first task is to show that cardinal finite types are closed under several
operations.
\section{Closure}
For the first three closure proofs, we only consider split enumerability:
as it is the strongest of the finiteness predicates, we can derive the other
closure proofs from it.

\begin{lemma}
  \(\bot\), \(\top\), and \(\mathbf{Bool}\) are split enumerable.
\end{lemma}
\begin{lemma} \label{split-enum-sigma}
  Split enumerability is closed under \(\Sigma\).
  \begin{equation}
    \frac{
      \mathcal{E}!(A) \; \; \; \Pi(x : A) , \mathcal{E}!(U(x))
    }{
      \mathcal{E}!(\Sigma(x : A) , U(x))
    }
  \end{equation}
\end{lemma}
From this we can derive split enumerability of non-dependent sums and products,
as both are definable in terms of \(\Sigma\).

\begin{lemma}
  Split enumerability is closed under dependent functions.
  (\(\Pi\)-types).
  \begin{equation}
    \frac{
      \mathcal{E}!(A) \; \; \; \Pi {(x : A)} , \mathcal{E}!\left( U(x) \right)
    }{
      \mathcal{E}!\left(\Pi {(x : A)} , U(x)\right)
    }
  \end{equation}
\end{lemma}
\begin{proof}
  Let \(A\) be a split enumerable type, and \(U\) be a type family from \(A\),
  which is split enumerable over all points of \(A\).

  As \(A\) is split enumerable, we know that it is also manifestly Bishop finite
  (lemma~\ref{split-enum-to-manifest-bishop}), and consequently we know \(A
  \simeq \mathbf{Fin}(n)\), for some \(n\) (lemma~\ref{bishop-equiv}).
  We can therefore replace all occurrences of \(A\) with \(\mathbf{Fin}(n)\),
  changing our goal to:
  \begin{equation}
    \frac{
      \mathcal{E}!(\mathbf{Fin}(n)) \; \; \; \Pi (x : \mathbf{Fin}(n)) , \mathcal{E}!\left( U(x) \right)
    }{
      \mathcal{E}!\left(\Pi (x : \mathbf{Fin}(n)) , U(x)\right)
    }
  \end{equation}
  
  We then define the type of \(n\)-tuples over some type family \(T :
  \mathbf{Fin}(n) \rightarrow \mathbf{Type}\).
  \begin{equation}
    \begin{alignedat}{3}
      & \mathbf{Tuple}(0, T)   &&\coloneqq \top \\
      & \mathbf{Tuple}(n+1, T) &&\coloneqq T(0) \times \mathbf{Tuple}(n, T \circ \text{suc})
    \end{alignedat}
  \end{equation}
  We can show that this type is equivalent to functions (proven in our formalisation):
  \begin{equation}
    \Pi(x : \mathbf{Fin}(n)) , U(x) \simeq \mathbf{Tuple}(n, U)
  \end{equation}
  And therefore we can simplify again our goal to the following:
  \begin{equation}
    \frac{
      \mathcal{E}!(\mathbf{Fin}(n)) \; \; \; \Pi (x : \mathbf{Fin}(n)) , \mathcal{E}!\left( U(x) \right)
    }{
      \mathcal{E}!\left(\mathbf{Tuple}(n, U)\right)
    }
  \end{equation}
  
  We can prove this goal by showing that \(\mathbf{Tuple}(n, U)\) is split
  enumerable: it is made up of finitely many products of points of \(U\), which
  are themselves split enumerable, and \(\top\), which is also split enumerable.
  Lemma~\ref{split-enum-sigma} shows us that the product of finitely many split
  enumerable types is itself split enumerable, proving our goal.
\end{proof}

Lifting the above closure proofs to work on proofs of \(\mathcal{C}\) is not
necessarily straightforward.
\(\lVert \wc \rVert\) forms a monad, giving us access to a powerful syntax for
combining proofs.
From this, we can derive closure under \(\bot\), \(\top\), \(\mathbf{Bool}\),
\(\times\), \(\uplus\), and \(\rightarrow\).
The dependent case is not so straightforward.
We need the following lemma, a version of the axiom of choice on finite sets,
to prove closure under \(\Sigma\) and \(\Pi\).
\begin{lemma}
  \begin{equation}
    \mathcal{C}(A) \rightarrow (\Pi(x : A) , \lVert U(x) \rVert) \rightarrow \lVert \Pi(x : A) , U(x) \rVert
  \end{equation}
\end{lemma}
\section{The Category of Finite Sets}
HoTT and CuTT seem to be especially suitable settings for formalisations of
category theory.
The univalence axiom in particular allows us to treat categorical isomorphisms
as equalities, saving us from the dreaded ``setoid hell''.

We follow \cite[chapter 9]{hottbook} in its treatment of
categories in HoTT, and in its proof that sets do indeed form a category.
We will first briefly go through the construction of the category
\(\mathit{Set}\), as it differs slightly from the usual method in type theory.

First, the type of objects and arrows:
\begin{alignat}{3}
  &\text{Obj}_\mathit{Set}      &&\coloneqq \Sigma(x : \mathbf{Type}) , \text{isSet}(x) \\
  &\text{Hom}_\mathit{Set}(x , y) &&\coloneqq  \text{fst}(x) \rightarrow \text{fst}(y)
\end{alignat}
As the type of objects makes clear, we have already departed slightly from the
simpler \(\text{Obj}_\mathit{Set} \coloneqq \mathbf{Type}\) way of doing things:
of course we have to, as HoTT allows non-set types.
Furthermore, after proving the usual associativity and identity laws for
composition (which are definitionally true in this case), we must further show
\(\text{isSet}(\text{Hom}_\mathit{Set}(x,y))\); even then we only have a
precategory.

To show that \(\mathit{Set}\) is a category, we must show that categorical
isomorphisms are equivalent to equivalences.
In a sense, we must give a univalence rule for the category we are working in.

We have provided formal proofs that \(\mathit{Set}\) does indeed form a
category, and the following:
\begin{theorem}[The Category of Finite Sets]
  Finite sets form a category in HoTT when defined like so:
  \begin{equation}
    \begin{alignedat}{3}
      &\text{Obj}_\mathit{FinSet}      &&\coloneqq \Sigma(x : \mathbf{Type}) , \mathcal{C}(x) \\
      &\text{Hom}_\mathit{FinSet}(x , y) &&\coloneqq  \text{fst}(x) \rightarrow \text{fst}(y)
    \end{alignedat}
  \end{equation}
\end{theorem}
\section{The \(\Pi\)-pretopos of Finite Sets}
For this proof, we follow again the proof that \(\mathit{Set}\) forms a \(\Pi
W\)-pretopos from \cite[chapter 10]{hottbook} and
\cite{rijkeSetsHomotopyType2015}.
The difference here is that clearly we do not have access to \(W\)-types, as
they would permit infinitary structures.

We first must show that \(\mathit{Set}\) has an initial object and finite,
disjoint sums, which are stable under pullback.
We also must show that \(\mathit{Set}\) is a regular category with effective
quotients.
We now have a pretopos: the presence of \(\Pi\) types make it a
\(\Pi\)-pretopos.

We have proven the above statements for both \(\mathit{Set}\) and
\(\mathit{FinSet}\).
As far as we know, this is the first formalisation of either.
\begin{theorem} \label{finite-topos}
  The category of finite sets, \(\mathit{FinSet}\), forms a \(\Pi\)-pretopos.
\end{theorem}


%%% Local Variables:
%%% mode: latex
%%% TeX-master: "../paper"
%%% End: